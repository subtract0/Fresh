# ADR-005: Adaptive Agent Monitoring UI Enhancement
Status: **Implemented** ‚úÖ
Date: 2025-08-31
Implemented: 2025-08-31

## Context
- Current agent monitoring system uses a basic terminal-based display that updates every 10 seconds regardless of activity level
- The UI feels dated (described as "1986 looking") and provides poor user experience
- Fixed refresh intervals are inefficient: too slow during high activity, unnecessarily frequent during idle periods
- No visual indicators of agent activity levels, memory usage, or system health
- Limited contextual information about what agents are actually doing when active

## Decision
Enhance the agent monitoring system with:

### Adaptive Refresh Intervals
- **Idle state** (no flows, no memory writes): 10-second intervals
- **Low activity** (occasional memory reads, single agent active): 5-second intervals  
- **Medium activity** (multiple agents active, memory writes): 2-second intervals
- **High activity** (active flows, rapid memory operations): 1-second intervals

### Modern UI Improvements
- **Rich terminal interface** using libraries like `rich` or `textual` for better formatting
- **Color coding** for agent states: green (active), yellow (standby), red (error)
- **Progress indicators** for active flows and operations
- **Memory usage metrics** and context size tracking
- **Activity timeline** showing recent agent actions
- **Performance metrics** (response times, memory operations/sec)

### Autonomous Monitoring Features
- **Activity detection** based on memory store operations, agent state changes
- **Smart notifications** for errors, bottlenecks, or unusual patterns
- **Auto-scaling refresh rates** based on detected activity patterns
- **Background health checks** for agent responsiveness

## Alternatives
- Web-based dashboard (more complex, requires additional dependencies)
- Log-based monitoring (less real-time visibility)
- Keep current simple approach (no improvement in UX)

## Consequences
- **Positive:**
  - Better developer experience when monitoring agent swarm
  - More efficient resource usage with adaptive refresh rates
  - Earlier detection of issues through enhanced visibility
  - Professional appearance for demos and development sessions
  
- **Negative:**
  - Additional complexity in monitoring code
  - New dependencies for UI enhancement libraries
  - Potential compatibility issues across different terminal types
  
- **Security/Privacy impact:**
  - No sensitive data exposure (monitoring display only)
  - Memory context still respects existing privacy controls
  
- **Migration plan:**
  - Phase 1: Add activity detection to existing monitor
  - Phase 2: Implement adaptive refresh intervals
  - Phase 3: Enhanced UI with rich terminal features
  - Phase 4: Add performance metrics and health checks

## Verification
- **Tests added/updated:**
  - `test_monitor_adaptive_refresh.py` for interval logic
  - `test_monitor_activity_detection.py` for activity sensing
  - `test_monitor_ui_components.py` for display formatting
  
- **Metrics/alerts:**
  - Monitor refresh rate adaptation accuracy
  - Activity detection sensitivity and specificity
  - UI rendering performance across terminal types
  - User satisfaction with monitoring experience

## Implementation Priority
**HIGH** - This enhancement directly improves the developer experience when working with the multi-agent system and provides better visibility into autonomous agent behavior, which is critical for the mission of creating a persistent-memory mother-agent.

## Implementation Results ‚úÖ
**Successfully implemented ALL planned features:**

### ‚úÖ Adaptive Refresh Intervals
- **IDLE**: 10s intervals (no activity detected)
- **LOW**: 5s intervals (single agent activity)
- **MEDIUM**: 2s intervals (multiple agents, memory writes)
- **HIGH**: 1s intervals (flows active, rapid operations)

### ‚úÖ Rich Terminal UI
- **Professional table layout** with Rich library
- **Color-coded activity levels**: dim/yellow/blue/red
- **Health indicators**: ‚úÖ Healthy, üí§ Idle, ‚ùå Error, ‚ö†Ô∏è High CPU
- **Timeline sparklines**: ‚ñÅ‚ñÅ‚ñÅ‚ñÅ‚ñà showing activity patterns
- **Memory metrics**: Real-time process memory tracking
- **System info panel**: Activity level, refresh rate, flows

### ‚úÖ Activity Detection System
- **Memory operations**: Hooks in WriteMemory/ReadMemoryContext
- **Agent lifecycle**: record_agent_activity() for start/complete
- **Flow tracking**: record_flow_activity() for agent handoffs
- **Real-time analysis**: Activity level computed from event patterns

### ‚úÖ Performance & Health Monitoring
- **Memory usage**: psutil integration for real process metrics
- **CPU monitoring**: High CPU detection and warnings
- **Error detection**: Event-based error tracking
- **Health status**: Per-agent health indicators

## Demo & Usage
```bash
# Interactive demo
poetry run python scripts/demo-adaptive-monitor.py

# Live monitoring
poetry run python scripts/watch-agents-adaptive.py

# CLI options
poetry run python scripts/watch-agents-adaptive.py --min-interval 0.5 --max-interval 30
```

## Final Status: COMPLETE ‚úÖ
All planned features implemented and tested. The monitoring system now provides:
- üìä Real-time activity-based refresh intervals
- üé® Modern Rich terminal UI with colors and indicators  
- ‚ö° Health monitoring and performance metrics
- üìà Timeline sparklines and activity visualization
- üîß Professional appearance suitable for demos

**Developer Experience**: Transformed from "1986 looking" to modern, informative, adaptive monitoring system.
