# ADR-010: Documentation Truth Matrix

Date: 2025-09-04
Status: Accepted

## Context

The Fresh codebase suffered from significant documentation drift, where:
- Documentation claimed features existed that were not implemented
- Different documents made conflicting claims about functionality
- Developers were confused about what actually worked vs what was aspirational
- No automated way to verify documentation accuracy

This created a "broken windows" problem where false documentation led to confusion and wasted effort.

## Decision

We will implement a **Documentation Truth Matrix** system that:

1. **Automated Inventory**: Scripts that scan the codebase to detect actual implementations
2. **Feature Status Matrix**: Auto-generated truth table showing Implemented/Partial/Missing status
3. **Documentation Guardrails**: Tests that prevent false claims in documentation
4. **Single Source of Truth**: `docs/FEATURE_STATUS.md` as canonical reference

### Implementation Components

#### 1. Inventory Script (`scripts/inventory_codebase.py`)
- Scans for Python functions, classes, CLI commands
- Detects shell scripts and their executable status
- Finds test files and CI workflows
- Outputs `docs/_generated/inventory.json`

#### 2. Feature Analyzer (`scripts/analyze_feature_status.py`)
- Compares inventory against feature checks
- Classifies each feature as Implemented/Partial/Missing
- Generates `docs/FEATURE_STATUS.md` with evidence
- Groups features by status for clarity

#### 3. Alignment Tests (`tests/test_docs_alignment.py`)
- Ensures WARP.md doesn't claim missing features work
- Verifies README.md references Feature Status Matrix
- Checks documentation doesn't make false claims
- Validates inventory freshness

#### 4. Documentation Structure
- WARP.md: Clear sections for "‚úÖ What Works", "‚ö†Ô∏è Partial", "üöß Planned"
- README.md: References Feature Status Matrix as truth
- All claims marked with verification status

## Consequences

### Positive
- **Clarity**: Developers instantly know what actually works
- **Trust**: Documentation is verifiably accurate
- **Automation**: Truth matrix regenerates with one command
- **Prevention**: Tests catch documentation drift before merge
- **Transparency**: Evidence provided for each feature's status

### Negative
- **Maintenance**: Must update analyzer when adding features
- **Discipline**: Requires running inventory scripts regularly
- **Overhead**: Additional test suite to maintain

### Mitigation
- CI workflow runs documentation checks automatically
- Simple commands to regenerate truth matrix
- Clear documentation of the process itself

## Implementation Status

‚úÖ **Completed**:
- Created `scripts/inventory_codebase.py` 
- Created `scripts/analyze_feature_status.py`
- Generated `docs/FEATURE_STATUS.md`
- Updated WARP.md with truth-based sections
- Updated README.md to reference Feature Status
- Created `tests/test_docs_alignment.py`
- Made all scripts executable

## Usage

To verify or update documentation accuracy:

```bash
# Regenerate truth matrix
poetry run python scripts/inventory_codebase.py
poetry run python scripts/analyze_feature_status.py

# Run alignment tests
poetry run pytest tests/test_docs_alignment.py

# View current status
cat docs/FEATURE_STATUS.md
```

## References

- Feature Status Matrix: `docs/FEATURE_STATUS.md`
- Previous ADRs on documentation: ADR-001, ADR-008
- No Broken Windows principle
