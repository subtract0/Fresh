# ADR-011: Fresh v1.0 - From Components to Cohesive System

Date: 2025-09-04
Status: Accepted

## Context

Fresh has evolved into a collection of powerful components:
- Memory systems (InMemory, Intelligent, Firestore)
- Agent architecture (Mother, Father, enhanced agents)
- Development tools (scan, spawn, run)
- Documentation and testing infrastructure

However, these components don't work together seamlessly. Users need to understand too much implementation detail to get value. The system lacks the "magic" that would make it immediately valuable.

## Decision

We will implement Fresh v1.0 following a phased approach that:

1. **Completes core infrastructure** - Makes existing components work reliably end-to-end
2. **Creates the "magic command"** - Single entry point that delivers immediate value
3. **Provides real-world templates** - Production-ready scaffolds users actually need
4. **Implements learning loop** - Agents that genuinely improve over time

### Key Architectural Decisions

#### 1. Magic Command Pattern
```bash
fresh fix "description of problem"
```
- Single entry point for all agent operations
- Natural language task description
- Automatic agent selection and orchestration

#### 2. Memory-First Architecture
- Every agent action recorded in memory
- Pattern analysis after each task
- Strategy updates based on outcomes
- Cross-session learning as default

#### 3. Template-Driven Development
- Production-ready templates, not toys
- Include CI/CD, monitoring, auth
- Customizable via parameters
- Self-documenting

#### 4. Dogfooding Mandate
- Use Fresh to build Fresh features
- Every bug fixed with `fresh fix`
- Every feature added with `fresh add`
- Proves the system works

## Implementation Strategy

### Phase 1: Infrastructure (Week 1)
- Complete FirestoreMemoryStore with Docker
- Wire Mother Agent end-to-end
- Create integration test suite

### Phase 2: Magic Command (Week 2)
- Unified CLI entry point
- Task understanding engine
- Progress tracking UI

### Phase 3: Templates (Week 3)
- FastAPI template
- Next.js template
- CLI tool template

### Phase 4: Learning & Polish (Week 4)
- Outcome tracking
- Pattern analysis
- Documentation & recipes

## Consequences

### Positive
- **Immediate value**: Users get results in minutes, not hours
- **True learning**: Agents improve measurably over time
- **Production ready**: Templates are actually usable
- **Proven system**: Dogfooding ensures it works

### Negative
- **Complexity**: More moving parts to maintain
- **Testing burden**: Integration tests are harder
- **Docker dependency**: Firestore emulator requires Docker

### Mitigation
- Comprehensive integration tests
- Gradual rollout with feature flags
- Clear documentation and recipes
- Fallback to simpler stores when Docker unavailable

## Success Criteria

1. **Functionality**: All v1.0 features work end-to-end
2. **Performance**: Command to PR in < 5 minutes
3. **Reliability**: > 80% success rate on common tasks
4. **Learning**: Measurable improvement in agent performance
5. **Adoption**: Used to build actual features in Fresh

## Technical Specifications

### Magic Command Flow
```
User Input → Task Parser → Memory Lookup → Agent Selection → 
Execution → Outcome Recording → Pattern Analysis → PR Creation
```

### Memory Schema Extension
```python
class TaskOutcome:
    task_description: str
    approach_used: str
    success: bool
    metrics: Dict[str, float]
    lessons_learned: List[str]
```

### Template Structure
```
templates/
  fastapi/
    {{cookiecutter.project_name}}/
      src/
      tests/
      docker/
      .github/workflows/
    cookiecutter.json
```

## References

- [ROADMAP_V1.md](../../docs/ROADMAP_V1.md)
- [FEATURE_STATUS.md](../../docs/FEATURE_STATUS.md)
- ADR-004: Persistent Memory Architecture
- ADR-010: Documentation Truth Matrix
