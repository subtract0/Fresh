# ADR-008: Autonomous Development Loop for Visible Agent Activity

## Status
In Progress

## Context
The Fresh agent system has sophisticated agents (Father, Architect, Developer, QA, Reviewer) but lacks visible, autonomous activity. The system needs to demonstrate tangible value through:
- Automatic detection and fixing of repository issues
- Continuous, visible code improvements
- Automated PR creation showing agent work
- Real-time monitoring of agent activity

Current state: "I don't see much of an effect of this whole codebase" - agents exist but aren't actively working.

## Decision
Implement an autonomous development loop that continuously scans the repository for issues, dispatches agents to fix them, and creates visible PRs, making the agent system's value immediately apparent.

### Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                  Autonomous Development Loop                 │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌──────────┐     ┌────────┐     ┌───────────┐             │
│  │Repository│────►│Scanner │────►│  Mother   │             │
│  │  State   │     │        │     │   Agent   │             │
│  └──────────┘     └────────┘     └─────┬─────┘             │
│       ▲                                 │                    │
│       │                                 ▼                    │
│       │                          ┌─────────────┐            │
│       │                          │Agent Swarm  │            │
│       │                          │ ┌─────────┐ │            │
│       │                          │ │ Father  │ │            │
│       │                          │ └────┬────┘ │            │
│       │                          │      ▼      │            │
│       │                          │ [Architect] │            │
│       │                          │      ▼      │            │
│       │                          │ [Developer] │            │
│       │                          │      ▼      │            │
│       │                          │    [QA]     │            │
│       │                          │      ▼      │            │
│       │                          │  [Reviewer] │            │
│       │                          └──────┬──────┘            │
│       │                                 │                    │
│       │                                 ▼                    │
│  ┌────┴─────┐     ┌────────┐     ┌───────────┐            │
│  │   Git    │◄────│Commits │◄────│ Artifacts │            │
│  │  Branch  │     │        │     │           │            │
│  └────┬─────┘     └────────┘     └───────────┘            │
│       │                                                      │
│       ▼                                                      │
│  ┌──────────┐                    ┌────────────┐            │
│  │ GitHub   │───────────────────►│ Dashboard  │            │
│  │    PR    │                    │ (Real-time)│            │
│  └──────────┘                    └────────────┘            │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

### Core Components

#### 1. Mother Agent (`ai/agents/mother.py`)
```python
class MotherAgent:
    def run(self, name: str, instructions: str, 
            model: str = "gpt-4", output_type: str = "code") -> AgentResult:
        """Spawn and manage child agents for specific tasks."""
```

#### 2. Repository Scanner (`ai/loop/repo_scanner.py`)
```python
def scan_repository() -> List[Task]:
    """Detect issues: TODOs, FIXMEs, failing tests, type errors."""
    # Returns structured tasks with priority and context
```

#### 3. Development Loop (`ai/loop/dev_loop.py`)
```python
async def run_dev_loop(once: bool = False, watch: bool = False):
    """Main autonomous loop: scan → dispatch → commit → PR."""
```

#### 4. CLI Interface (`ai/cli/fresh.py`)
```bash
fresh scan                    # Find issues in codebase
fresh run --once             # Single development cycle
fresh run --watch            # Continuous monitoring
fresh monitor                # Live dashboard
fresh spawn "fix bug #123"   # Direct task dispatch
```

### Implementation Timeline

**Phase 1: Core Functionality (Current)**
- [x] Fix failing tests (COMPLETE)
- [x] Create ADR-008 (COMPLETE)
- [ ] Implement Mother Agent with tests
- [ ] Build Repository Scanner
- [ ] Create basic dev loop

**Phase 2: Integration**
- [ ] GitHub PR automation
- [ ] Real-time dashboard (Rich/Textual)
- [ ] Memory persistence for context

**Phase 3: Production**
- [ ] Daemon mode
- [ ] E2E tests
- [ ] Documentation

## Consequences

### Positive
- **Immediate Visibility**: PRs appear automatically, showing agent work
- **Self-Improving**: Codebase continuously gets better
- **Measurable Impact**: Track bugs fixed, tests added, coverage improved
- **Developer Relief**: Automates routine fixes and improvements

### Negative
- **PR Noise**: May create many PRs requiring review
- **Resource Usage**: Continuous API calls and processing
- **False Positives**: May misidentify issues

### Mitigations
- Rate limiting and batching PRs
- Configurable sensitivity thresholds
- Human approval gates for major changes

## Verification
- Tests for each component (TDD approach)
- E2E test with mock GitHub
- Manual testing with real repository

## Success Metrics
- PRs created per day: Target 5-10
- PR acceptance rate: Target >80%
- TODO/FIXME reduction: Target 50% in first month
- Test coverage increase: Target +10% monthly

## References
- ADR-001: TDD and ADR Discipline
- ADR-003: Persistent Memory Architecture
- Issue: User request for visible agent effects
- Related: `ai/integration/github.py`, `ai/agency.py`

## Next Steps
1. Implement Mother Agent class with test coverage
2. Build repository scanner for issue detection
3. Wire up basic autonomous loop
4. Add GitHub PR creation
5. Build real-time monitoring dashboard
